<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>D3 Example</title>
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <style>

  .axis text {
    font-size: 15pt;
  }
  .axis .label {
    font-size: 20pt;
  }
  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    stroke-width: 1px;
    shape-rendering: crispEdges;
  }

  .bar {
    fill: #fa3838;
  }
  .y.axis path, .y.axis line {
    stroke: none;
  }

  .toolTip {
    position: absolute;
    display: none;
    min-width: 80px;
    height: auto;
    background: none repeat scroll 0 0 #ffffff;
    border: 1px solid #000;
    padding: 14px;
    text-align: center;
  }
  #div_graph, #checkbox{
    text-align: left;

  }
  #title{
    text-align: center;
  }
  label{
    cursor:pointer;
  }
  </style>
  <body>
    <div class="row">
      <div id= "div_graph" class="col-sm-6">
        <h2 id= "title">Top 15 paises com mais inimigos</h2>
        <svg id = "Graph_1" width="960" height="500"></svg>
      </div>
      <div id="checkbox" class="col-sm-2">
        <h3> Filtrar continente: </h3>
        <div class="form-check">
          <label><input type="checkbox"  class="form-check-input"  onclick= "reDraw('America')"  id="check1"> America</label>
        </div>
        <div class="form-check">
          <label><input type="checkbox" onclick= "reDraw('Europa')" id="check2"> Europa</label>
        </div>
        <div class="form-check">
          <label><input type="checkbox" onclick= "reDraw('Asia')" id="check3"> Asia</label>
        </div>
        <div class="form-check">
          <label><input type="checkbox" onclick= "reDraw('Africa')" id="check4"> Africa</label>
        </div>
        <div class="form-check">
          <label><input type="checkbox" onclick= "reDraw('Oceania')" id="check5"> Oceania</label>
        </div>

      </div>
    </div>
    <script>
    var outerWidth = 960;
    var outerHeight = 500;
    var margin = { left: 300, top: 40, right: 200, bottom: 90 };

    var barPadding = 0.2;
    var barPaddingOuter = 0.1;

    var xColumn = "population";
    var yColumn = "city";

    var xAxisLabelText = "Inimigos";
    var xAxisLabelOffset = 75;

    var innerWidth  = outerWidth  - margin.left - margin.right;
    var innerHeight = outerHeight - margin.top  - margin.bottom;

    var svg = d3.select("#Graph_1")
    .attr("width",  outerWidth)
    .attr("height", outerHeight);

    var tooltip = d3.select("body").append("div").attr("class", "toolTip");


    var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var xAxisG = g.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + innerHeight + ")")

    var xAxisLabel = xAxisG.append("text")
    .style("text-anchor", "middle")
    .attr("x", innerWidth / 2)
    .attr("y", xAxisLabelOffset)
    .attr("class", "label")
    .text(xAxisLabelText);

    var yAxisG = g.append("g")
    .attr("class", "y axis");
    var xScale = d3.scale.linear().range([0, innerWidth]);
    var yScale = d3.scale.ordinal().rangeRoundBands([0, innerHeight], barPadding, barPaddingOuter);
    var xAxis = d3.svg.axis().scale(xScale).orient("bottom")
    .ticks(5)
    .tickFormat(d3.format("s"))
    .outerTickSize(0);
    var yAxis = d3.svg.axis().scale(yScale).orient("left")
    .outerTickSize(0);



    var filterData={"Europa":true,"Asia":true,"America":true};//cities to be shown

    var legendParties = ['Europa','Asia','America', 'Oceania'];





    function drawChart(filterData){
      d3.csv("cit.csv", type, function(error, data) {


        xScale.domain([0, d3.max(data, function (d){ return d[xColumn]; })]);
        yScale.domain(       data.map( function (d){ return d[yColumn]; }));
        xAxisG.call(xAxis);
        yAxisG.call(yAxis);


        var bars = g.selectAll("rect").data(data.filter(function(d){return filterData[d.continent]==true;}));
        bars.enter().append("rect")
        .attr("height", yScale.rangeBand()).attr("class", "bar");

        bars.attr("x", 0)
        .attr("y",     function (d){ return yScale(d[yColumn]); })
        .attr("width", function (d){ return xScale(d[xColumn]); })
        .on("mousemove", function(d){
          tooltip
          .style("left", d3.event.pageX - 50 + "px")
          .style("top", d3.event.pageY - 70 + "px")
          .style("display", "inline-block")
          .html((d.city) + "<br>" + "Total:" + (d.population) + "<br>" );
        })
        .on("mouseout", function(d){ tooltip.style("display", "none");})
        .enter()
        .append('text')
        .attr("id", function(d){ if (d.city == "Estados Unidos" ){
          return "USA";
        }
        else{return d.city }})
        .attr({'x':function(d) { return xScale(d[xColumn])+15; },'y':function(d,i){ return yScale(d[yColumn])+17; }})
        .text(function(d){ return d.population;}).style({'fill':'#000','font-size':'15px'});


        for(i = 0; i < data.length; i++){
          if(filterData[data[i].continent] == false ){
            if(data[i].city == "Estados Unidos"){
              d3.selectAll("#USA").style("display", "none");
            }else{
              d3.selectAll("#"+data[i].city).style("display", "none");
            }

          }else{
            if(data[i].city == "Estados Unidos"){
              d3.selectAll("#USA").style("display", "block");
            }else{
              d3.selectAll("#"+data[i].city).style("display", "block");
            }

          }

        }

        bars.exit().remove();
      });
    }

    drawChart(filterData);
    function type(d){
      d.population = +d.population;
      return d;
    }
    function reDraw(name){

      filterData[name]=!filterData[name];

      drawChart(filterData);
    }

    </script>
